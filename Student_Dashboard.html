<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="assets/css/css/sb-admin-2.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
</head>

<body id="page-top">
    <div id="wrapper">

        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <hr class="sidebar-divider my-0">

            <div class="sidebar-heading">
                <img width="80" height="70" src="assets/img/Homepage/usaas_logo.svg" />
            </div>

            <li class="nav-item active">
                <a class="nav-link" href="Student_Dashboard.html">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Student Dashboard</span></a>
            </li>


            <hr class="sidebar-divider">


            <div class="sidebar-heading">
                Interface
            </div>


            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                    aria-expanded="true" aria-controls="collapseTwo">
                    <i class="fas fa-fw fa-chart-area"></i>
                    <span>Order</span>
                </a>
                <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Order List:</h6>
                        <a class="collapse-item" href="Student_Createorder.html">Create Order</a>
                        <a class="collapse-item" href="Student_Orderlist.html">Check Order</a>
                    </div>
                </div>
            </li>


            <li class="nav-item">
                <a class="nav-link collapsed" href="Student_Document.html" data-target="#collapseUtilities"
                    aria-expanded="true" aria-controls="collapseUtilities">
                    <i class="fas fa-fw fa-table"></i>
                    <span>Document</span>
                </a>
            </li>

            <li class="nav-item">
                <a class="nav-link collapsed" href="Student_Wallet.html" data-target="#collapseWallet"
                    aria-expanded="true" aria-controls="collapseWallet">
                    <i class="fas fa-fw fa-folder"></i>
                    <span>Wallet</span>
                </a>
            </li>


            <hr class="sidebar-divider">


            <div class="sidebar-heading">
                Settings
            </div>


            <li class="nav-item">
                <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapsePages"
                    aria-expanded="true" aria-controls="collapsePages">
                    <i class="fas fa-fw fa-wrench "></i>
                    <span>Settings</span>
                </a>
                <div id="collapsePages" class="collapse" aria-labelledby="headingPages" data-parent="#accordionSidebar">
                    <div class="bg-white py-2 collapse-inner rounded">
                        <h6 class="collapse-header">Profile: </h6>
                        <a class="collapse-item" href="Student_Settings.html">Profile Settings</a>
                        <a class="collapse-item" href="Student_Settings.html">Forgot Password</a>
                    </div>
                </div>
            </li>

            <li class="nav-item">
                <a class="nav-link" href="Student_Support.html">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>Help & support</span></a>
            </li>


            <hr class="sidebar-divider d-none d-md-block">


            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>


        </ul>
        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">

                <!--username display copy from Here-->
                <nav class="bg-white shadow navbar navbar-expand navbar-light topbar mb-4 static-top">
                    <div>
                        <button class="btn btn-link d-md-none rounded-circle mr-3" id="sidebarToggleTop"><i
                                class="fas fa-bars"></i></button>
                    </div>

                    <!--Search Bar-->
                    <form
                        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group"><input class="bg-light border-0 form-control form-control small"
                                type="text" aria-describedby="basic-addon2" aria-label="Search"
                                placeholder="Search for...">
                            <div class="input-group-text input-group-append"><button class="btn btn-primary"
                                    type="button"><i class="fas fa-search fa-sm"></i></button></div>
                        </div>
                    </form>


                    <ul class="navbar-nav ml-auto">

                        <!--Message Bar-->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a id="messagesDropdown" class="nav-link dropdown-toggle" href="#" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <div class="sidebar-heading">Message </div>
                                <i class="fas fa-envelope fa-fw"></i>
                                <span class="badge badge-danger badge-counter">7</span>
                            </a>

                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="messagesDropdown">
                                <h6 class="dropdown-header">
                                    Message Center
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3"><img class="rounded-circle"
                                            src="assets/img/undraw_profile_1.svg" alt="..." />
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">I had accept your order</div>
                                        <div class="small text-gray-500">Assistant Ashton</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3"><img class="rounded-circle"
                                            src="assets/img/undraw_profile_2.svg" alt="..." />
                                        <div class="status-indicator"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Your order had completed</div>
                                        <div class="small text-gray-500">Airi Satou · 1d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3"><img class="rounded-circle"
                                            src="assets/img/undraw_profile_3.svg" alt="..." />
                                        <div class="status-indicator bg-warning"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">alright, All done, your document had approved</div>
                                        <div class="small text-gray-500">Cedric Kelly · 2d</div>
                                    </div>
                                </a>

                                <a class="dropdown-item text-center small text-gray-500" href="#">Read More Messages</a>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!--username display copy from Here-->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" id="userDropdown" role="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                <img class="img-profile rounded-circle" src="assets/img/undraw_profile_2.svg">
                                <strong><span id="loggedUserFName"
                                        class="mr-2 d-none d-lg-inline text-gray-600 small"></span></strong>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" id="logout" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Logout
                                </a>
                            </div>
                        </li>

                    </ul>
                </nav>

                <div class="container-fluid">
                    <div class="d-sm-flex justify-content-between align-items-center mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
                    </div>
                    <div class="row" style="margin-right: 0;">
                        <div class="col">
                            <div class="card shadow mb-4">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
                                        <div class="col mr-2" style="margin-left: 15px;">
                                            <div class="text-uppercase text-primary text-xs font-weight-bold mb-1"><span
                                                    style="--bs-success: #95e1d3;--bs-success-rgb: 149,225,211;">Including
                                                    translation &amp; transportation</span></div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800"><span>Try your First
                                                    Asssistant Registration</span></div>
                                        </div>
                                        <div class="col d-xl-flex justify-content-xl-end align-items-xl-center"
                                            style="text-align: right;"><a
                                                class="btn btn-primary btn-sm shadow-sm d-none d-sm-inline-block"
                                                role="button" href="Student_Createorder.html"
                                                style="background: rgb(149,225,211);color: var(--bs-body-color);"><i
                                                    class="fas fa-download text-white-50 fa-sm"></i>&nbsp;Create
                                                Order</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="text-primary m-0 font-weight-bold">Services</h6>
                                </div>
                                <div class="card-body">
                                    <h4 class="small font-weight-bold">Server Migration <span
                                            class="float-right">20%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="bg-danger progress-bar" role="progressbar" style="width:20%;"
                                            aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Sales Tracking <span
                                            class="float-right">40%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="bg-warning progress-bar" role="progressbar" style="width: 40%;"
                                            aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Customer Database <span
                                            class="float-right">60%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="progress-bar" role="progressbar" style="width:60%;"
                                            aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Payout Details <span
                                            class="float-right">80%</span></h4>
                                    <div class="progress mb-4">
                                        <div class="bg-info progress-bar" role="progressbar" style="width:80%;"
                                            aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <h4 class="small font-weight-bold">Account Setup <span
                                            class="float-right">Complete!</span></h4>
                                    <div class="progress">
                                        <div class="bg-success progress-bar" role="progressbar" style="width:100%;"
                                            aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="col-lg-6 mb-4">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="text-primary m-0 font-weight-bold">Our Services</h6>
                                </div>
                                <div class="card-body">
                                    <div class="text-center"><img class="img-fluid px-3 px-sm-4 mt-3 mb-4"
                                            style="width:25rem;" src="assets/img/Homepage/usaas_logo.svg" alt="..."
                                            width="400" height="199"></div>
                                    <p>Our core values focus on trust, support, and<br>delivering quality services to
                                        students</p><a target="_blank" rel="nofollow" href="https://homepage.com">Click
                                        here for more information</a>
                                </div>
                            </div>
                        </div>



                        <div class="row">
                            <div class="col-lg-6 col-xl-12 mb-4">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="text-primary m-0 font-weight-bold">Development Approach</h6>
                                    </div>
                                    <div class="card-body">
                                        <p>USAAS (UTM Student Assistance Application System) is an innovative platform
                                            designed to connect students with academic assistants,
                                            providing seamless support for their learning needs. With USAAS, students
                                            can easily create orders for assistance, track their requests in real time,
                                            and manage payments securely through an integrated wallet system. </p>
                                        <p class="mb-0">Our goal is to enhance the academic experience by ensuring
                                            smooth communication, efficient order management,
                                            and reliable payment processing, making registration process more accessible
                                            and stress-free.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="bg-white sticky-footer">
                <div class="container-fluid px-4">
                    <div class="text-left my-auto copyright justify-content-between small">
                        <span style="font-family: Amiko, sans-serif;">Copyright © Desvin Lee 2024</span>
                    </div>
                </div>
            </footer>

        </div>
    </div><a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a>

    <div class="modal fade" role="dialog" tabindex="-1" id="logoutModal" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5><button aria-label="Close"
                        class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span></button>
                </div>
                <div class="modal-body"><span>Select "Logout" below if you are ready to end your current session.</span>
                </div>
                <div class="modal-footer"><button class="btn btn-secondary" data-dismiss="modal"
                        type="button">Cancel</button><a class="btn btn-primary" role="button"
                        href="login.html">Logout</a></div>
            </div>
        </div>
    </div>

    <script src="assets/js/vendor/jquery/jquery.min.js"></script>
    <script src="assets/js/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="assets/js/js/sb-admin-2.min.js"></script>
    <script src="assets/js/vendor/chart.js/Chart.min.js"></script>
    <script src="assets/js/js/Navigationbar.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, getDoc, doc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js"

        const firebaseConfig = {
            apiKey: "AIzaSyAifkBmMPwQLTqRu8nYFU1dqej2dlX33Bk",
            authDomain: "usaas-4230f.firebaseapp.com",
            databaseURL: "https://usaas-4230f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "usaas-4230f",
            storageBucket: "usaas-4230f.firebasestorage.app",
            messagingSenderId: "1057123876526",
            appId: "1:1057123876526:web:fb4c3c0e6b2407295f773f",
            measurementId: "G-NSW66N1VGP"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        const auth = getAuth();
        const db = getFirestore();

        let inactivityTimer;

        // ✅ Auto-logout after 30 mins of inactivity
        function startInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                signOut(auth).then(() => {
                    alert("You have been logged out due to 30 minutes of inactivity.");
                    localStorage.removeItem("loggedInUserId"); // Clear session
                    window.location.href = "login.html"; // Redirect to login
                });
            }, 30 * 60 * 1000); // 30 mins
        }

        // ✅ Reset timer on any activity
        function resetTimerOnActivity() {
            ["mousemove", "keypress", "click", "scroll"].forEach((event) => {
                window.addEventListener(event, startInactivityTimer);
            });
        }

        // ✅ Auth state + display first name + start timer
        onAuthStateChanged(auth, (user) => {
            const loggedInUserId = localStorage.getItem('loggedInUserId');

            if (user && loggedInUserId) {
                console.log("User logged in:", user);

                // Display first name
                const docRef = doc(db, "users", loggedInUserId);
                getDoc(docRef)
                    .then((docSnap) => {
                        if (docSnap.exists()) {
                            const userData = docSnap.data();
                            document.getElementById('loggedUserFName').innerText = userData.firstName || "User";
                        } else {
                            console.log("No document found for this user ID.");
                        }
                    })
                    .catch((error) => {
                        console.error("Error getting document:", error);
                    });

                // Start inactivity logic
                startInactivityTimer();
                resetTimerOnActivity();
            } else {
                console.log("User not authenticated.");
                window.location.href = "login.html";
            }
        });

        const logoutButton = document.getElementById('logout');
        const confirmLogoutButton = document.querySelector('#logoutModal .btn-primary[href="login.html"]'); // Select the Logout button in the modal

        logoutButton.addEventListener('click', () => {
            localStorage.removeItem('loggedInUserId');
            // The modal will now be shown due to the data-toggle and data-target attributes on the <a> tag
        });

        if (confirmLogoutButton) {
            confirmLogoutButton.addEventListener('click', (event) => {
                event.preventDefault(); // Prevent the default link behavior (immediate navigation)
                signOut(auth)
                    .then(() => {
                        window.location.href = 'login.html';
                    })
                    .catch((error) => {
                        console.error('Error Signing out:', error);
                    });
            });
        }
    </script>
</body>

</html>